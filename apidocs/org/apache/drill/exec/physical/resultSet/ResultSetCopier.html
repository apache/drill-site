<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) -->
<title>ResultSetCopier (Drill : 1.21.2-SNAPSHOT API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="description" content="declaration: package: org.apache.drill.exec.physical.resultSet, interface: ResultSetCopier">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../../../script.js"></script>
<script type="text/javascript" src="../../../../../../script-dir/jquery-3.6.1.min.js"></script>
<script type="text/javascript" src="../../../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var evenRowColor = "even-row-color";
var oddRowColor = "odd-row-color";
var tableTab = "table-tab";
var activeTableTab = "active-table-tab";
var pathtoroot = "../../../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="class-use/ResultSetCopier.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../help-doc.html#class">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method-summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method-detail">Method</a></li>
</ul>
</div>
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">org.apache.drill.exec.physical.resultSet</a></div>
<h1 title="Interface ResultSetCopier" class="title">Interface ResultSetCopier</h1>
</div>
<section class="class-description" id="class-description">
<dl class="notes">
<dt>All Known Implementing Classes:</dt>
<dd><code><a href="impl/ResultSetCopierImpl.html" title="class in org.apache.drill.exec.physical.resultSet.impl">ResultSetCopierImpl</a></code></dd>
</dl>
<hr>
<div class="type-signature"><span class="modifiers">public interface </span><span class="element-name type-name-label">ResultSetCopier</span></div>
<div class="block">Copies rows from an input batch to an output batch. The input
 batch is assumed to have a selection vector, or the caller
 will pick the rows to copy.
 <p>
 Works to create full output batches to minimize per-batch
 overhead and to eliminate unnecessary empty batches if no
 rows are copied.
 <p>
 The output batches are assumed to have the same schema as
 input batches. (No projection occurs.) The output schema will
 change each time the input schema changes. (For an SV4, then
 the upstream operator must have ensured all batches covered
 by the SV4 have the same schema.)
 <p>
 This implementation works with a single stream of batches which,
 following Drill's rules, must consist of the same set of vectors on
 each non-schema-change batch.

 <h4>Protocol</h4>

 Overall lifecycle:
 <ol>
 <li>Create an instance of the
     <a href="impl/ResultSetCopierImpl.html" title="class in org.apache.drill.exec.physical.resultSet.impl"><code>ResultSetCopierImpl</code></a> class, passing the input row set reader
      to the constructor.</li>
 <li>Loop to process each output batch as shown below. That is, continually
     process calls to the <a href="../impl/aggregate/BatchIterator.html#next()"><code>BatchIterator.next()</code></a> method.</li>
 <li>Call <a href="#close()"><code>close()</code></a>.</li>
 </ol>
 <p>

 To build each output batch:

 <pre><code>
 public IterOutcome next() {
   copier.startOutputBatch();
   while (!copier.isFull() {
     IterOutcome innerResult = inner.next();
     if (innerResult == DONE) { break; }
     copier.startInputBatch();
     copier.copyAllRows();
   }
   if (copier.hasRows()) {
     outputContainer = copier.harvest();
     return outputContainer.isSchemaChanged() ? OK_NEW_SCHEMA ? OK;
   } else { return DONE; }
 }
 </code></pre>
 <p>
 The above assumes that the upstream operator can be polled
 multiple times in the DONE state. The extra polling is
 needed to handle any in-flight copies when the input
 exhausts its batches.
 <p>
 The above also shows that the copier handles and reports
 schema changes by setting the schema change flag in the
 output container. Real code must handle multiple calls to
 next() in the DONE state, and work around lack of such support
 in its input (perhaps by tracking a state.)
 <p>
 An input batch is processed by copying the rows. Copying can be done
 row-by row, via a row range, or by copying the entire input batch as
 shown in the example.
 Copying the entire batch make sense when the input batch carries as
 selection vector that identifies which rows to copy, in which
 order.
 <p>
 Because we wish to fill the output batch, we may be able to copy
 part of a batch, the whole batch, or multiple batches to the output.</div>
</section>
<section class="summary">
<ul class="summary-list">
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">All Methods</button><button id="method-summary-table-tab2" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab2', 3)" class="table-tab">Instance Methods</button><button id="method-summary-table-tab3" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab3', 3)" class="table-tab">Abstract Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel">
<div class="summary-table three-column-summary" aria-labelledby="method-summary-table-tab0">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Method</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#close()" class="member-name-link">close</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Release resources, including any pending input batch
 and any non-harvested output batch.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#copyAllRows()" class="member-name-link">copyAllRows</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Copy all (remaining) input rows to the output.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code>boolean</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#copyNextRow()" class="member-name-link">copyNextRow</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">If copying rows one by one, copy the next row from the
 input.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#copyRow(int)" class="member-name-link">copyRow</a><wbr>(int&nbsp;inputRowIndex)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Copy a row at the given position.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="../../record/VectorContainer.html" title="class in org.apache.drill.exec.record">VectorContainer</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#harvest()" class="member-name-link">harvest</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Obtain the output batch.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code>boolean</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#hasOutputRows()" class="member-name-link">hasOutputRows</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Reports if the output batch has rows.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code>boolean</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#isCopyPending()" class="member-name-link">isCopyPending</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Helper method to determine if a copy is pending: more rows
 remain to be copied.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code>boolean</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#isOutputFull()" class="member-name-link">isOutputFull</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Reports if the output batch is full and must be sent
 downstream.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code>boolean</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#nextInputBatch()" class="member-name-link">nextInputBatch</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Start the next input batch.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#startOutputBatch()" class="member-name-link">startOutputBatch</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Start the next output batch.</div>
</div>
</div>
</div>
</div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="startOutputBatch()">
<h3>startOutputBatch</h3>
<div class="member-signature"><span class="return-type">void</span>&nbsp;<span class="element-name">startOutputBatch</span>()</div>
<div class="block">Start the next output batch.</div>
</section>
</li>
<li>
<section class="detail" id="nextInputBatch()">
<h3>nextInputBatch</h3>
<div class="member-signature"><span class="return-type">boolean</span>&nbsp;<span class="element-name">nextInputBatch</span>()</div>
<div class="block">Start the next input batch. The input batch must be held
 by the <code>ResultSetReader</code> passed into the constructor.</div>
</section>
</li>
<li>
<section class="detail" id="copyNextRow()">
<h3>copyNextRow</h3>
<div class="member-signature"><span class="return-type">boolean</span>&nbsp;<span class="element-name">copyNextRow</span>()</div>
<div class="block">If copying rows one by one, copy the next row from the
 input.</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>true if more rows remain on the input, false
 if all rows are exhausted</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="copyRow(int)">
<h3>copyRow</h3>
<div class="member-signature"><span class="return-type">void</span>&nbsp;<span class="element-name">copyRow</span><wbr><span class="parameters">(int&nbsp;inputRowIndex)</span></div>
<div class="block">Copy a row at the given position. For those cases in
 which random copying is needed, but a selection vector
 is not available. Note that this version is slow because
 of the need to reset indexes for every row. Better to
 use a selection vector, then copy sequentially.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>inputRowIndex</code> - the input row position. If a selection vector
 is attached, then this is the selection vector position</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="copyAllRows()">
<h3>copyAllRows</h3>
<div class="member-signature"><span class="return-type">void</span>&nbsp;<span class="element-name">copyAllRows</span>()</div>
<div class="block">Copy all (remaining) input rows to the output.
 If insufficient space exists in the output, does a partial
 copy, and <a href="#isCopyPending()"><code>isCopyPending()</code></a> will return true.</div>
</section>
</li>
<li>
<section class="detail" id="hasOutputRows()">
<h3>hasOutputRows</h3>
<div class="member-signature"><span class="return-type">boolean</span>&nbsp;<span class="element-name">hasOutputRows</span>()</div>
<div class="block">Reports if the output batch has rows. Useful after the end
 of input to determine if a partial output batch exists to
 send downstream.</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>true if the output batch has one or more rows</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="isOutputFull()">
<h3>isOutputFull</h3>
<div class="member-signature"><span class="return-type">boolean</span>&nbsp;<span class="element-name">isOutputFull</span>()</div>
<div class="block">Reports if the output batch is full and must be sent
 downstream. The output batch can be full in the middle
 of a copy, in which case <a href="#isCopyPending()"><code>isCopyPending()</code></a> will
 also return true.
 <p>
 This function also returns true if a schema change
 occurred on the latest input row, in which case the
 partially-completed batch of the old schema must be
 flushed downstream.</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>true if the output is full and must be harvested
 and sent downstream</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="isCopyPending()">
<h3>isCopyPending</h3>
<div class="member-signature"><span class="return-type">boolean</span>&nbsp;<span class="element-name">isCopyPending</span>()</div>
<div class="block">Helper method to determine if a copy is pending: more rows
 remain to be copied. If so, start a new output batch, which
 will finish the copy. Do that before start a new input
 batch.</div>
<dl class="notes">
<dt>Returns:</dt>
</dl>
</section>
</li>
<li>
<section class="detail" id="harvest()">
<h3>harvest</h3>
<div class="member-signature"><span class="return-type"><a href="../../record/VectorContainer.html" title="class in org.apache.drill.exec.record">VectorContainer</a></span>&nbsp;<span class="element-name">harvest</span>()</div>
<div class="block">Obtain the output batch. Returned as a vector container
 since the output will not have a selection vector.</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>a vector container holding the output batch</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="close()">
<h3>close</h3>
<div class="member-signature"><span class="return-type">void</span>&nbsp;<span class="element-name">close</span>()</div>
<div class="block">Release resources, including any pending input batch
 and any non-harvested output batch.</div>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
<footer role="contentinfo">
<hr>
<p class="legal-copy"><small>Copyright &#169; 2023 <a href="https://www.apache.org/">The Apache Software Foundation</a>. All rights reserved.</small></p>
</footer>
</div>
</div>
</body>
</html>
